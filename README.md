# LISSA Infrastructure

The LISSA Infrastructure project can be used to provision one or more servers
with the services needed for running the LISSA tech stack. It uses Chef for
provisioning machines and comes with a Vagrantfile for testing LISSA on your
local machine.

## Requirements (Vagrant)

- Virtualbox 4.3.10+
- Vagrant 1.6.3+
    - Vagrant Omnibus plugin. Use `vagrant plugin install vagrant-omnibus`, if
      the installer returns an error about not being able to install 'nokogiri'
      then install the xcode command line tools by executing `xcode-select --install`
    - Vagrant Hostsupdater plugin. Use `vagrant plugin install vagrant-hostsupdater`

## Installation

- cd to the root of this project
- Execute `vagrant up --provision` (takes at least 10 minutes)
- To deploy LISSA Kickstart clone the [deploy respository](https://github.com/oneagency/lissa_deploy)
  and follow the instructions in the readme.

Please see Troubleshooting if deploying LISSA Kickstart doesn't work.

## Usage

- Drupal backend URL: http://admin.lissa.dev
- Host path to drupal: admin-server/docroot
- Vagrant path to drupal: /var/www/admin-server/docroot

See the [LISSA Kickstart readme](https://github.com/ONEAgency/lissa_kickstart/blob/8.0.x/README.md) for more info.

## Services

The Vagrant box comes with the following services.

| Service | Host | Port | Endpoint | Path | Credentials | Info |
|---------|------|------|----------|------|-------------|------|
| Drupal backend | admin.lissa.dev | 80 || /var/www/admin-server/docroot | admin:admin ||
| RabbitMQ message queue | admin.lissa.dev | 15672 ||| guest:guest ||
| Worker | admin.lissa.dev ||| /usr/local/share/lissa_worker || PHP script running from /usr/share/workerusing supervisord |
| Nginx push stream server | admin.lissa.dev | 8080 | /publish ||| Accepts notifications to be sent to the websocket connections. |
| Nginx push stream server websockets | admin.lissa.dev| 8080 | /ws/[uuid] ||| Websocket connection, uuid maps to the event node's uuid |

## Remote and Multi Server Support

By default the LISSA infrastructure will be deployed to a single node. It's perfectly possible to use separate servers for each service by using the included Chef roles and overriding the configuration files.

## Troubleshooting

### When deploying LISSA Kickstart I get a "Authentication failed for user vagrant@admin.lissa.dev" error.

Add the private key generated by Vagrant.

You can find the path to the key by running `vagrant ssh-config` from the root
of this repository.

You can add the key by running `ssh-add -K /path/to/private_key`.
